!function(){CKEDITOR.dialog.add("attachment",function(t){function e(t){var e=t.split("/").pop(),i=e.split(".").pop();return{filename:e,className:"attach_"+i}}var i=/^(_(?:self|top|parent|blank))$/,n=function(t,e){var n=e?e.getAttribute("_cke_saved_href")||e.getAttribute("href"):"",s={};if(s.type="url",s.url=n,e){var o=e.getAttribute("target");if(s.target={},o){var a=o.match(i);a?s.target.type=s.target.name=o:(s.target.type="frame",s.target.name=o)}s.title=e.getAttribute("title")}for(var r=t.document.getElementsByTag("img"),l=new CKEDITOR.dom.nodeList(t.document.$.anchors),c=s.anchors=[],u=0;u<r.count();u++){var d=r.getItem(u);d.getAttribute("_cke_realelement")&&"anchor"==d.getAttribute("_cke_real_element_type")&&c.push(t.restoreRealElement(d))}for(u=0;u<l.count();u++)c.push(l.getItem(u));for(u=0;u<c.length;u++)d=c[u],c[u]={name:d.getAttribute("name"),id:d.getAttribute("id")};return this._.selectedElement=e,s},s=function(){var e=this.getDialog(),i=e.getContentElement("general","linkTargetName"),n=this.getValue();i&&(i.setLabel(t.lang.link.targetFrameName),this.getDialog().setValueOf("general","linkTargetName","_"==n.charAt(0)?n:""))};return{title:t.lang.attachment.title,minWidth:420,minHeight:200,onShow:function(){this.fakeObj=!1;var t=this.getParentEditor(),e=t.getSelection(),i=e.getRanges(),s=null;if(1==i.length){var o=i[0].getCommonAncestor(!0);s=o.getAscendant("a",!0),s&&s.getAttribute("href")?e.selectElement(s):(s=o.getAscendant("img",!0))&&s.getAttribute("_cke_real_element_type")&&"anchor"==s.getAttribute("_cke_real_element_type")?(this.fakeObj=s,s=t.restoreRealElement(this.fakeObj),e.selectElement(this.fakeObj)):s=null}this.setupContent(n.apply(this,[t,s]))},onOk:function(){var t={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},i=[],n={href:t.href},s=this.getParentEditor();this.commitContent(n);var o=n.url||"";t._cke_saved_href=0===o.indexOf("/")?o:"http://"+o;{var a=e(o);n.title||""}if(t.title=0==n.title.length?a.filename:n.title,t["class"]=a.className,n.target&&("notSet"!=n.target.type&&n.target.name?t.target=n.target.name:i.push("target"),i.push("_cke_pa_onclick","onclick")),this._.selectedElement){var r=this._.selectedElement;if(CKEDITOR.env.ie&&t.name!=r.getAttribute("name")){var l=new CKEDITOR.dom.element('<a name="'+CKEDITOR.tools.htmlEncode(t.name)+'">',s.document);c=s.getSelection(),r.moveChildren(l),r.copyAttributes(l,{name:1}),l.replace(r),r=l,c.selectElement(r)}r.setAttributes(t),r.removeAttributes(i),r.getAttribute("title")&&r.setHtml(r.getAttribute("title")),r.getAttribute("name")?r.addClass("cke_anchor"):r.removeClass("cke_anchor"),this.fakeObj&&s.createFakeElement(r,"cke_anchor","anchor").replace(this.fakeObj),delete this._.selectedElement}else{var c=s.getSelection(),u=c.getRanges();if(1==u.length&&u[0].collapsed){var d=new CKEDITOR.dom.text(t.title,s.document);u[0].insertNode(d),u[0].selectNodeContents(d),c.selectRanges(u)}var h=new CKEDITOR.style({element:"a",attributes:t});h.type=CKEDITOR.STYLE_INLINE,h.apply(s.document)}},contents:[{label:t.lang.common.generalTab,id:"general",accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(t.lang.attachment.url)+"</span>"},{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"src",type:"text",label:"",validate:CKEDITOR.dialog.validate.notEmpty(t.lang.flash.validateSrc),setup:function(t){t.url&&this.setValue(t.url),this.select()},commit:function(t){t.url=this.getValue()}},{type:"button",id:"browse",filebrowser:"general:src",hidden:!0,align:"center",label:t.lang.common.browseServer}]}]},{type:"vbox",padding:0,children:[{id:"name",type:"text",label:t.lang.attachment.name,setup:function(t){t.title&&this.setValue(t.title)},commit:function(t){t.title=this.getValue()}}]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:t.lang.link.target,"default":"notSet",style:"width : 100%;",items:[[t.lang.link.targetNotSet,"notSet"],[t.lang.link.targetFrame,"frame"],[t.lang.link.targetNew,"_blank"],[t.lang.link.targetTop,"_top"],[t.lang.link.targetSelf,"_self"],[t.lang.link.targetParent,"_parent"]],onChange:s,setup:function(t){t.target&&this.setValue(t.target.type)},commit:function(t){t.target||(t.target={}),t.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:t.lang.link.targetFrameName,"default":"",setup:function(t){t.target&&this.setValue(t.target.name)},commit:function(t){t.target||(t.target={}),t.target.name=this.getValue()}}]}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:t.lang.common.upload,elements:[{type:"file",id:"upload",label:t.lang.common.upload,size:38},{type:"fileButton",id:"uploadButton",label:t.lang.common.uploadSubmit,filebrowser:"general:src","for":["Upload","upload"]}]}]}})}();